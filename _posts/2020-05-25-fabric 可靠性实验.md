---
layout:     post
title:      fabric  可靠性实验
date:       2020-05-25
author:     Charlie Lin
catalog:    true
tags:
     - hyperledger/fabric
--

# fabric 可靠性实验

## fabric 网络部署说明
longzhou-orderer： 排序服务所在服务器
longzhou-org1： peer0.org1 peer1.org1 peer2.org1 所在机器
longzhou-org2： peer0.org2 peer1.org2 peer2.org2 所在机器
longzhou-org3： peer0.org3 peer1.org3 所在机器

## 实验一
现在依次重启运行各个节点的服务器，观察各个节点状态是否正常。

### 重启 org3 节点所在的机器
机器重启后，重新启动容器，执行`peer channel list` 命令，一切正常

### 重启 longzhou-orderer
机器重启后，重新启动容器，执行`peer channel list` 命令，一切正常


## 实验二
将 org2 的三个 peer 节点停掉一个，观察执行 chaincode 程序的情况

关闭 peer2.org2.nd.com.cn 节点
```shell
docker stop peer2.org2.nd.com.cn
```
运行客户端，发行票据
```shell
java -cp commercial-paper-0.0.1-SNAPSHOT.jar org.magnetocorp.Issue
``` 
发行成功：
![](https://tva1.sinaimg.cn/large/007S8ZIlgy1gfoev3x1f5j30ph061djz.jpg)

观察各个节点的 couchdb 数据：

`peer0.org2.nd.com.cn` 与 `peer1.org2.nd.com.cn`
![](https://tva1.sinaimg.cn/large/007S8ZIlgy1gfof4f2kmaj30c60d00tu.jpg)

`peer2.org2.nd.com.cn` 与它们不同
![](https://tva1.sinaimg.cn/large/007S8ZIlgy1gfof6f50rbj30bp0cxmy9.jpg)

接着把 `peer2.org2.nd.com.cn` 拉起来
```shell
docker start peer2.org2.nd.com.cn
``` 
可以观察到启动日志
![](https://tva1.sinaimg.cn/large/007S8ZIlgy1gfofh2o1izj31h205uwnl.jpg)
此时 `peer2.org2.nd.com.cn` 的 couchdb 已经与其他两个 peer 节点同步
![](https://tva1.sinaimg.cn/large/007S8ZIlgy1gfofjugnvyj30bh0cpjsh.jpg)

## 实验三

在实验二的基础上，关闭两个 peer 节点，观察运行结果。
### 关闭 peer1 与 peer2
```shell
docker stop peer1.org2.nd.com.cn
docker stop peer2.org2.nd.com.cn
``` 
运行客户端，发行票据
```shell
java -cp commercial-paper-0.0.1-SNAPSHOT.jar org.magnetocorp.Issue
``` 
与事先设想的不同，发行成功了
![](https://tva1.sinaimg.cn/large/007S8ZIlgy1gfog6wdwejj30mn061wi9.jpg)
观察几个 couchdb 的值：
`peer0.org2.nd.com.cn`
![](https://tva1.sinaimg.cn/large/007S8ZIlgy1gfog7zz205j30ci0crt9u.jpg)
`peer1.org2.nd.com.cn`
![](https://tva1.sinaimg.cn/large/007S8ZIlgy1gfog8lm89tj30cb0cqab6.jpg)
`peer2.org2.nd.com.cn`
![](https://tva1.sinaimg.cn/large/007S8ZIlgy1gfog9e0jpoj30b80cumy8.jpg)
只有 peer2.org2 的 couchdb 没有更新状态，peer1.org2 也更新了状态。
## 实验四

docker kill couchdb 后，chaincode 的执行也会报错，peer 节点也会关闭。
---
layout:     post
title:      fabric  可靠性实验
date:       2020-05-25
author:     Charlie Lin
catalog:    true
tags:
     - hyperledger/fabric
--

# fabric 可靠性实验

## 实验一
分布式部署的 fabric 网络，三个组织，都已加入了 mychannel。
现在分别重启运行各个节点的服务器，观察可靠性。

## 重启 org3
机器重启后，重新启动容器，执行`peer channel list` 命令，一切正常

## 重启 orderer
机器重启后，重新启动容器，执行`peer channel list` 命令，一切正常


## 实验二
将某个组织的两个 peer 节点停掉一个，观察执行 chaincode 程序的情况

在 longzhou-org2 上 `docker kill peer1.org1.nd.com.cn`，再执行 chaincode 程序报错：
```
java -cp commercial-paper-0.0.1-SNAPSHOT.jar org.magnetocorp.Issue
Read wallet info from: ./wallet
log4j:WARN No appenders could be found for logger (org.hyperledger.fabric.sdk.helper.Config).
log4j:WARN Please initialize the log4j system properly.
log4j:WARN See http://logging.apache.org/log4j/1.2/faq.html#noconfig for more info.
Use network channel: mychannel.
Use org.papernet.commercialpaper smart contract.
Submit commercial paper issue transaction.
Process issue transaction response.
Paper::00001   00001 MagnetoCorp 5000000
五月 26, 2020 10:45:48 下午 io.grpc.internal.SerializingExecutor run
严重: Exception while executing runnable io.grpc.internal.ClientCallImpl$ClientStreamListenerImpl$1StreamClosed@33e490d6
java.lang.NullPointerException
	at org.hyperledger.fabric.sdk.Channel.getExecutorService(Channel.java:1981)
	at org.hyperledger.fabric.sdk.Peer.getExecutorService(Peer.java:134)
	at org.hyperledger.fabric.sdk.Peer.reconnectPeerEventServiceClient(Peer.java:379)
	at org.hyperledger.fabric.sdk.PeerEventServiceClient$1.onError(PeerEventServiceClient.java:288)
	at io.grpc.stub.ClientCalls$StreamObserverToCallListenerAdapter.onClose(ClientCalls.java:442)
	at io.grpc.PartialForwardingClientCallListener.onClose(PartialForwardingClientCallListener.java:39)
	at io.grpc.ForwardingClientCallListener.onClose(ForwardingClientCallListener.java:23)
	at io.grpc.ForwardingClientCallListener$SimpleForwardingClientCallListener.onClose(ForwardingClientCallListener.java:40)
	at io.grpc.internal.CensusStatsModule$StatsClientInterceptor$1$1.onClose(CensusStatsModule.java:700)
	at io.grpc.PartialForwardingClientCallListener.onClose(PartialForwardingClientCallListener.java:39)
	at io.grpc.ForwardingClientCallListener.onClose(ForwardingClientCallListener.java:23)
	at io.grpc.ForwardingClientCallListener$SimpleForwardingClientCallListener.onClose(ForwardingClientCallListener.java:40)
	at io.grpc.internal.CensusTracingModule$TracingClientInterceptor$1$1.onClose(CensusTracingModule.java:399)
	at io.grpc.internal.ClientCallImpl.closeObserver(ClientCallImpl.java:510)
	at io.grpc.internal.ClientCallImpl.access$300(ClientCallImpl.java:66)
	at io.grpc.internal.ClientCallImpl$ClientStreamListenerImpl.close(ClientCallImpl.java:630)
	at io.grpc.internal.ClientCallImpl$ClientStreamListenerImpl.access$700(ClientCallImpl.java:518)
	at io.grpc.internal.ClientCallImpl$ClientStreamListenerImpl$1StreamClosed.runInternal(ClientCallImpl.java:692)
	at io.grpc.internal.ClientCallImpl$ClientStreamListenerImpl$1StreamClosed.runInContext(ClientCallImpl.java:681)
	at io.grpc.internal.ContextRunnable.run(ContextRunnable.java:37)
	at io.grpc.internal.SerializingExecutor.run(SerializingExecutor.java:123)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	at java.lang.Thread.run(Thread.java:745)
```
重新启动`docker start peer1.org2.nd.com.cn` 后，再执行 chaincode 程序正常。

## 实验三

在 magnetocorp 发行票据成功后，将 org1 与 org2 的机器重启。再用 digibank 购买，显示成功。（重复购买是会显示失败）

## 实验四

docker kill couchdb 后，chaincode 的执行也会报错，peer 节点也会关闭。